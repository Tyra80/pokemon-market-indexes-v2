# ============================================================
# Pokemon Market Indexes v2 - Keepalive
# ============================================================
# Pings the database every 5 days to prevent Supabase pause
# (Free tier pauses after 1 week of inactivity)
# ============================================================

name: Keepalive

on:
  schedule:
    - cron: '0 12 */5 * *'  # Every 5 days at 12:00 UTC
  workflow_dispatch:

jobs:
  keepalive:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ Install dependencies
        run: pip install -r requirements.txt
      
      - name: ğŸ“ Ping Database
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: |
          python -c "
          from scripts.utils import get_db_client
          client = get_db_client()
          result = client.from_('sets').select('set_id').limit(1).execute()
          print(f'âœ… Keepalive OK - Database is active')
          "